为了在 RTKLIB 中得到一个高精度的固定解，我们需要解算来自载波相位测量的整周模糊度。由于 GLONASS 采用 FDMA 信号，GLONASS卫星的发射频率都略有不同。 这在接收器硬件中引入了一个额外的频间偏差。解算 GLONASS 卫星的整周模糊度比其他系统更具挑战性。

这些频间偏差是恒定的，对于同一制造商的所有接收器来说通常是相同的，与载波频率成正比，并且在 L1 和 L2 之间是相似的。

在 RTKLIB 的 demo5 版本中，对于如何进行 GLONASS 模糊度解算（AR）有四个选择。我将简要介绍这四种选择，但随后将重点介绍我在 demo5 代码的最新版本（b29c）中加强的 "autocal "设置。

**Off**：如果 Glonass AR 被设置为 "OFF"，那么 Glonass 卫星的原始测量值将被用于浮动解算，但模糊性解算将仅由其他星座的卫星完成。 如果你没有使用 RTKLIB 的 Demo5 版本，当流动站和基准站使用不同厂家的接收机时，这通常是你唯一的选择。 然而，由于忽略了 GLONASS 的模糊度，你放弃了大量的信息，因此，如果你使用 Demo5 代码，我不建议使用这种设置，当然，除非你的接收机不支持 Glonass 卫星。

**On**：如果 Glonass AR 设置为 "ON"，那么 RTKLIB 将把 Glonass 的模糊度与其他星座的模糊度同等对待，不会尝试考虑额外的频间偏差。 如果你的基准站和流动站接收机来自同一个制造商，请使用这个设置，因为在这种情况下，偏差将被抵消，可以被忽略。 也有一些情况，不同的制造商有相等或几乎相等的偏差，我们将在后面看到，在这种情况下，你也可以使用这个设置。 这是你处理Glonass 模糊度的最佳解算方案。 如果可能的话，我总是尽量为基准站和流动站使用匹配的接收机。

**Fix-and-Hold**：这是我添加到 Glonass AR 的 Demo5 代码中的一个选项。 它是对用于其他星座的 "Fix-and-Hold"方法的扩展，但它不是使用额外的反馈来保持模糊度，而是使用它来消除频间偏差。 我建议在使用未匹配的接收机的 demo5 代码时采用这种设置。 它在大多数情况下利用了Glonass 模糊的额外信息。 然而，在实现首次固定后，才会启用 Fix-and-Hold，因此 Glonass 的模糊信息在那之前是不可用的。 与 "ON "选项相比，这可能意味着首次固定的时间更长，稳定性更差，所以对于匹配的接收机不要使用这个选项。

**Auto-cal**：这个选项为卡尔曼滤波器增加了额外的状态，以估计作为载波频率函数的接收机频间偏差，一个状态用于 L1，另一个用于 L2。 在以前的实验中，我没有用它取得过任何成功。 然而，最近我发现，如果我调整了滤波器的设置，它可以对零基线的情况有效，在这种情况下，基准站和流动站都连接到同一个天线上，这样几乎所有其他的误差都被完全抵消了。 通过更多的实验，我还发现，对于短基线，如果在开始求解前将卡尔曼滤波的状态预设为接近最终值，它也是有效的。 然后，它通常会收敛到正确的偏差值。 然而，目前代码中没有调整这些数值的机制，所以我没有发现这种模式在目前的实现中是有用的。

为了使自动计算选项更加灵活，并希望更加有用，我在 b29c 代码中对其做了一些修改。 我增加了预设初始状态值的功能，同时也调整了内部滤波器的设置，特别是这个状态的初始方差和过程噪声。 状态的单位，也就是初始值的单位，是每一个频率通道的米数，每一个通道的数值一般在 +/-5厘米之内。 我使用了一些目前尚未使用的现有配置参数，以减少我需要修改的代码量。 不幸的是，这意味着这些名称并不像它们可以描述的那样。 新的配置参数是：

```
pos2-arthres2 = relative GLONASS hardware bias in meters per frequency slot
pos2-arthres3 = initial variance of GLONASS hardware bias states
pos-arthres4 = process noise for GLONASS hardware bias states
```

一些最受欢迎的大地测量接收机的频间偏差值已经公布，但对于成本较低或不太受欢迎的接收机，一般没有。 以下是 Lambert Wanninger 在2011年发表的一篇[论文](http://acc.igs.org/biases/glonass-phase-biases_jog11.pdf)中的数值表，涉及 9 家接收机制造商。

![biases](https://pic-bed-1316053657.cos.ap-nanjing.myqcloud.com/img/biases.png) 

我能够验证 Trimble、Leica 和 Novatel 的这些结果，但我发现 Septentrio 的数值要低得多，所以我怀疑他们较新的接收机的偏差可能已经改变。

为了演示修改后的 **Auto-cal** 选项，我将从 ComNav 接收机和 Tersus 接收机之间的零基线情况开始。 在零基线情况下，测量频间偏差是最容易的，因为大多数其他误差将被抵消，频间偏差将是最主要的误差。 在这种情况下，我将初始方差设置从原来的 1.0 大幅降低到 1E-7，并将过程噪声从 1E-6 提高到 1E-3。

我在初始偏置值设置为 -.05 和 0.06 之间的不同情况下做了几次解算。 下面是 L1 和 L2 的结果：

![biases1](https://rtklibexplorer.files.wordpress.com/2018/06/biases1.png?w=840) 

收敛就发生在实现第一次固定之后。 如果没有达到固定值，那么状态就不会收敛，正如你在上面0.06 的例子中看到的那样。  在这种情况下，初始值离正确的值太远，导致无法获得固定值。 正如你所看到的，所有其他的情况都朝着 -0.022 左右的单一数值收敛，无论是对 L1 还是对 L2。

另一种可视化初始值误差的方法是看首次固定后的 GLONASS 残差。 下图显示了不同初始值的GLONASS L1 载波相位残差，左边是 0.03，中间是 -0.05，右边是我认为这个接收器组合的正确值 -0.022。

![acal1](https://pic-bed-1316053657.cos.ap-nanjing.myqcloud.com/img/acal1.png) 

下面是 L2 载波相位残差图：

![acal2](https://pic-bed-1316053657.cos.ap-nanjing.myqcloud.com/img/acal2.png) 

通过一个略显乏味的过程，我能够相当容易地将我所拥有的不同对接收机的残差迭代到接近零。 请注意，这给了我每个接收器对的相对偏差，而不是每个接收器的绝对值，这与 Wanniger 的表格不同，后者是针对绝对偏差的。

将该表扩展到附近 CORS 站所使用的接收机上，就有点难度了，因为初始偏差值需要相当接近，才能得到首次固定，从而达到收敛，但如果基站不是太远，还是可以的。  我找到了包括 Leica、Novatel、Trimble 和 Septentrio 接收机的 CORS 数据的数据集。 使用上述程序将残差迭代到接近零，然后我能够扩展我的表格，通过选择未知的偏移量使我的偏置对与 Wanninge r的表格保持一致，从而使数值绝对化。 这是我创建的结果表。**[Note: table updated 3/16/20:]** 

```
ComNav               =   2.3 cm
Leica                      =   2.3 cm
Novatel                 =  2.3 cm
Septentrio           = -0.3 cm
Spectra Physics =  0.0 cm
SwiftNav              =  0.0 cm
Tersus                   =  0.0 cm
Topcon                 =  0.0 cm
Trimble                = -0.7 cm
u-blox M8T        = -3.2 cm
u-blox F9P          =  0.0 cm
```

要从这个表格中为 RTKLIB 解算生成一个频间偏差的初始值，从流动站偏差中减去基准站偏差，然后除以 100，从厘米转换为米。 然后可以用这个值来设置配置文件中的 "pos2-arthres2 "配置参数。 对于 RTKPOST 和 RTKNAVI GUI 选项菜单，我将其标记为 "Glo HW Bias"。

为了在生成表格后在一组独立的数据上测试这段代码，我使用了一个读者最近寄给我的数据集。 它包括一个用于流动站的 u-blox M8T 接收机和几公里外用于基准站的 Leica 接收机，是在欧洲收集的。流动站的位置是静态的，但我在运动学模式下做解算，以使解算更具挑战性，并使解算中的任何错误更加明显。

为了给 RTKLIB 生成正确的配置值，我从上表中的 Leica 偏差 2.3 厘米减去 u-blox 偏差 -3.2 厘米，得到接收机之间的相对偏差为 -5.5 厘米或 -0.055 米。 尽管我在所有的运行中都设置了偏差，但除非 gloarmode 被设置为 autocal，否则偏差值会被忽略。 

以下是首次固定的时间，用于初始固定的卫星对的数量，以及10分钟后用于固定的卫星对的数量。

|                 | **Time to**   | sat pairs used      | sat pairs used fo    |
| --------------- | ------------- | ------------------- | -------------------- |
| **GLO AR mode** | **first fix** | **for initial fix** | **fix after 10 min** |
| OFF             | 4:10          | 7                   | 7                    |
| Fix&Hold        | 4:10          | 7                   | 11                   |
| Autocal         | 1:05          | 14                  | 14                   |
| On              | 6:47          | 14                  | 14                   |

正如你所期望的，gloarmode="off " 的首次固定时间与 "fix-and-hold "相同，因为 "fix-and-hold "不使用 GLONASS 卫星进行初始固定。 10分钟后，它仍然只包括四颗 GLONASS 卫星，这有点不寻常，通常我希望能包括更多的 GLONASS 卫星。

使用 gloarmode="autocal"，首次固定的时间从 250 秒减少到 65 秒，首次固定所包括的卫星数量从 7 颗增加到14 颗，都有明显的改进。

这个数据中最令人惊讶的是，当 gloarmode 被设置为 "on "时，它根本就获得了一个固定解。 在许多类似的情况下，它将永远不会得到一个固定。 但从下面可以看出，初始固定后的 GLONASS 载波相位的残差非常高。 左图是 gloarmode 设置为 "on"，右图是设置为 "autocal"。

![biases3](https://pic-bed-1316053657.cos.ap-nanjing.myqcloud.com/img/biases3.png) 

如下图所示，启用"autocal"时，模糊性解决率也高得多（黄色/绿色="autocal"，橄榄色/蓝色=ON），这提高了鲁棒性。

![biases2](https://pic-bed-1316053657.cos.ap-nanjing.myqcloud.com/img/biases2.png) 

巨大的残差并没有影响解算的位置，因为两个解算在任何时候都没有超过 2 毫米的差异。 然而，自动对焦的解算在这个意义上要稳健得多，因为它不太可能失去固定。

尽管我发现，在相对较短的基线（<10公里）上，启用自动对焦的结果通常很好，但我发现在较长的基线（ >25 公里）上，结果却不那么令人鼓舞。 在这种情况下，我发现我经常在将 pos-gloarmode 设置为 "fix-and-hold "时得到更好的结果，而在 "autocal " 时则不然。 我不明白这到底是为什么，但我怀疑 "fix-and-hold "的修正更为普遍，可能不仅仅是对 GLONASS 硬件偏差的修正。

这个功能的代码修改既包括在我的 Github [仓库](https://github.com/rtklibexplorer/RTKLIB)中，也包括在最新的可执行文件中，可从 rtkexplorer 网站下载。  如果你选择试验这个功能，请让我知道你是否在我的表格中发现任何错误，或者可以为任何额外的接收机添加数值。